<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.12.4/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.12.4/brython_stdlib.js"></script>
</head>
<body onload="brython({debug: 1, cache: true})">
<!-- input text -->
<input type="text" id="input" value="Hello, world!">
<script type="text/python">

import io
import gzip

import pyflate.log
from browser import document

def log(*args) -> None:
    """Log the arguments at the debug level."""
    s = f'[{bit.tellbits()}] '
    s += (" ".join(map(str, args)))
    # escape HTML entities
    document['output'] <= f"{s}\n"

pyflate.log = log
import pyflate

def print_hexdump(data: bytes) -> None:
    """Print a hexdump of the buffer."""
    output = "\n"
    for i in range(0, len(data), 4):
        b = data[i:i+4]
        output += (f'{i:08x}  ')
        for c in b:
            output += (f'{c:02x} ')
        # align
        for j in range(4 - len(b)):
            output += ('   ')



        output += (' [')


        for c in b:
            output += (f'{c:08b} ')

        # align
        for j in range(4 - len(b)):
            output += ('         ')

        output += ('] ')

        for c in b:
            # should we use a dot for non-output += able characters?
            if c < 32 or c > 126:
                output += ('.')
            else:
                output += (chr(c))
        output += '\n'
    log(output)


def run_program(*args):
    global bit
    document['output'].text = '' # Clear previous output
    s = document['input'].value
    try:
        buf = gzip.compress(s.encode())
        inp = io.BytesIO(buf)
        bit = pyflate.Bitfield(inp)
        print_hexdump(buf)
        out = pyflate.gzip_main_bitfield(bit)
        document['decompressed_data'].text = out.decode('utf-8')
    except Exception as e:
        log(f"Error: {e}")
        import traceback
        log(traceback.format_exc())

# Initial run
run_program()

# Add event listener for input change
document['input'].bind('input', run_program)

</script>
<pre id="output">Loading a demo of pyflate2. This will take a few seconds...

</pre>

Decompressed data: <span id="decompressed_data"></span>

<p>
    Code that's running this demo can be found at:

    <a href="https://github.com/d33mobile/pyflate2/">
    https://github.com/d33mobile/pyflate2/
    </a>
</p>

</body>
</html>
